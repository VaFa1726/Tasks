{% extends 'tasks/base.html' %}
{%load static%}
{% block content %}
<link rel="stylesheet" href="{%static "tasks/list.css"%}">
<div class="row">
  <div class="col-md-8">
    <h3>Task List</h3>
  </div>
  <div class="col-md-4 text-end">
    <form method="get" class="row g-2">
      <div class="col-auto">
        <select name="status" class="form-select">
          <option value="">All Statuses</option>
          <option value="todo" {% if filter_status == "todo" %}selected{% endif %}>Not Started</option>
          <option value="doing" {% if filter_status == "doing" %}selected{% endif %}>In Progress</option>
          <option value="done" {% if filter_status == "done" %}selected{% endif %}>Done</option>
        </select>
      </div>

      <div class="col-auto">
        <select name="priority" class="form-select">
          <option value="">All Priorities</option>
          <option value="high" {% if filter_priority == "high" %}selected{% endif %}>High</option>
          <option value="medium" {% if filter_priority == "medium" %}selected{% endif %}>Medium</option>
          <option value="low" {% if filter_priority == "low" %}selected{% endif %}>Low</option>
        </select>
      </div>

      <div class="col-auto">
        <select name="order" class="form-select">
          <option value="">Sort By</option>
          <option value="due" {% if order == "due" %}selected{% endif %}>Due Date</option>
          <option value="priority" {% if order == "priority" %}selected{% endif %}>Priority</option>
        </select>
      </div>

      <div class="col-auto">
        <button class="btn btn-outline-secondary">Apply</button>
      </div>
    </form>
  </div>
</div>

{% if due_soon %}
  <div class="alert alert-warning mt-3">
    Some tasks are due soon!
  </div>
{% endif %}

<table class="table table-striped mt-3">
  <thead>
    <tr>
      <th>Title</th>
      <th>Status</th>
      <th>Priority</th>
      <th>Due Date</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for task in tasks %}
      <tr>
        <td>{{ task.title }}</td>
        <td>{{ task.get_status_display }}</td>
        <td>{{ task.get_priority_display }}</td>
        <td>{{ task.due_date|date:"Y-m-d H:i" }}</td>
        <td>
          <!-- Edit Button -->
          <a href="{% url 'tasks:edit' task.id %}" class="btn btn-sm btn-warning">Edit</a>

          <!-- Delete Form -->
          <form action="{% url 'tasks:delete' task.id %}" method="post" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-danger"
                    onclick="return confirm('Are you sure you want to delete this task?');">
              Delete
            </button>
          </form>

          <!-- Toggle Complete Button -->
          <form action="{% url 'tasks:toggle' task.id %}" method="post" style="display:inline;">
            {% csrf_token %}
            {% if task.status != 'done' %}
              <button type="submit" class="btn btn-sm btn-success">Mark Done</button>
            {% else %}
              <button type="submit" class="btn btn-sm btn-secondary">Undo</button>
            {% endif %}
          </form>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="5" class="text-center">No tasks found</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
